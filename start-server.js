#!/usr/bin/env node

/**
 * ะกะบัะธะฟั ะฑััััะพะณะพ ะทะฐะฟััะบะฐ ะธะฝัะตัะฝะตั-ะผะฐะณะฐะทะธะฝะฐ ัะฟะพััะธะฒะฝะพะณะพ ะฟะธัะฐะฝะธั
 * ะะฒัะพั: ะะฐะปะธะตะฒ ะ. ะ., ะณััะฟะฟะฐ 036-22 SMMr
 */

const { spawn } = require('child_process');

// ะะพะปััะฐะตะผ ะฟะพัั ะธะท ะฐัะณัะผะตะฝัะพะฒ ะบะพะผะฐะฝะดะฝะพะน ัััะพะบะธ ะธะปะธ ะธัะฟะพะปัะทัะตะผ 8080 ะฟะพ ัะผะพะปัะฐะฝะธั
const port = process.argv[2] || 8080;

console.log(`๐ ะะฐะฟััะบ ะธะฝัะตัะฝะตั-ะผะฐะณะฐะทะธะฝะฐ ัะฟะพััะธะฒะฝะพะณะพ ะฟะธัะฐะฝะธั ะฝะฐ ะฟะพััั ${port}...`);
console.log(`๐จโ๐ป ะะฒัะพั: ะะฐะปะธะตะฒ ะ. ะ., ะณััะฟะฟะฐ 036-22 SMMr\n`);

// ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั ะดะปั ะฟะพััะฐ
process.env.PORT = port;

// ะะฐะฟััะบะฐะตะผ ะพัะฝะพะฒะฝะพะน ัะตัะฒะตั
const server = spawn('node', ['server.js'], {
    stdio: 'inherit',
    env: { ...process.env, PORT: port }
});

server.on('close', (code) => {
    console.log(`\n๐ ะกะตัะฒะตั ะทะฐะฒะตััะธะป ัะฐะฑะพัั ั ะบะพะดะพะผ ${code}`);
});

server.on('error', (err) => {
    console.error(`โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ: ${err.message}`);
});

// ะะฑัะฐะฑะพัะบะฐ ัะธะณะฝะฐะปะพะฒ ะดะปั ะบะพััะตะบัะฝะพะณะพ ะทะฐะฒะตััะตะฝะธั
process.on('SIGINT', () => {
    console.log('\n๐ ะะพะปััะตะฝ ัะธะณะฝะฐะป ะทะฐะฒะตััะตะฝะธั...');
    server.kill('SIGINT');
});

process.on('SIGTERM', () => {
    console.log('\n๐ ะะพะปััะตะฝ ัะธะณะฝะฐะป ะทะฐะฒะตััะตะฝะธั...');
    server.kill('SIGTERM');
});